<!-- LnwShop: กล่องทดลองสอบก่อนซื้อ (เลือกแล้วกดส่งคำตอบ) -->
<div id="lnwq-box" aria-live="polite">
  <div class="lnwq-container" role="region" aria-label="แบบทดลองสอบ">
    <div class="lnwq-header">
      <h2 class="lnwq-title">แบบทดลองสอบ: นักวิชาการพาณิชย์</h2>
      <p class="lnwq-subtitle">กรมเจรจาการค้าระหว่างประเทศ</p>
    </div>

    <div class="lnwq-body">
      <div id="lnwq-panel">
        <p id="lnwq-qtext" class="lnwq-qtext">ข้อ 1. โจทย์จะแสดงที่นี่</p>

        <form id="lnwq-form" class="lnwq-choices" aria-label="ตัวเลือกคำตอบ">
          <!-- ตัวเลือกจะถูกใส่ด้วย JS -->
        </form>

        <div id="lnwq-explain" class="lnwq-explain" hidden>
          <div id="lnwq-judge" class="lnwq-judge" role="status" aria-live="polite"></div>
          <strong>คำเฉลย:</strong> <span id="lnwq-explain-text"></span>
        </div>

        <div class="lnwq-actions">
          <button id="lnwq-submit" class="lnwq-btn" disabled>ส่งคำตอบ</button>
          <button id="lnwq-next" class="lnwq-btn lnwq-secondary" hidden>ข้อถัดไป</button>
        </div>
        <div class="lnwq-progress" id="lnwq-progress">ข้อ 1 / 10</div>
      </div>

      <div id="lnwq-result" class="lnwq-result" hidden>
        <h3>จบแบบทดลองสอบ</h3>
        <p>คะแนนของคุณ: <b id="lnwq-score">0/0</b></p>
        <button id="lnwq-restart" class="lnwq-btn lnwq-success">ทำใหม่อีกครั้ง</button>
      </div>
    </div>
  </div>
</div>

<style>
  /* ===== Scoped styles (prefix lnwq-) ===== */
  #lnwq-box{--p:#005c97;--p2:#363795;--ok:#198754;--bad:#dc3545;--muted:#6c757d;--text:#333}
  #lnwq-box{font-family:"Sarabun",system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans Thai",sans-serif;color:var(--text)}
  #lnwq-box .lnwq-container{background:#fff;border-radius:14px;box-shadow:0 6px 24px rgba(0,0,0,.08);max-width:800px;margin:16px auto;overflow:hidden}
  #lnwq-box .lnwq-header{background:linear-gradient(135deg,var(--p),var(--p2));color:#fff;padding:18px 22px;text-align:center}
  #lnwq-box .lnwq-title{margin:0;font-size:1.3rem}
  #lnwq-box .lnwq-subtitle{margin:.25rem 0 0;opacity:.95}
  #lnwq-box .lnwq-body{padding:22px}
  #lnwq-box .lnwq-qtext{font-weight:700;line-height:1.7;margin:0 0 12px}
  #lnwq-box .lnwq-choices{display:grid;gap:10px;margin:0 0 10px}
  #lnwq-box .lnwq-choice{display:flex;align-items:flex-start;gap:10px;background:#f8f9fa;border:2px solid #ced4da;border-radius:10px;padding:12px}
  #lnwq-box .lnwq-choice input{margin-top:3px;min-width:18px}
  #lnwq-box .lnwq-letter{display:inline-block;min-width:1.8em;font-weight:700}
  #lnwq-box .lnwq-choice.correct{background:#d1e7dd;border-color:var(--ok);color:#0f5132}
  #lnwq-box .lnwq-choice.wrong{background:#f8d7da;border-color:var(--bad);color:#842029}
  #lnwq-box .lnwq-explain{background:#f8f9fa;border-left:5px solid #6c757d;padding:12px 14px;margin-top:12px}
  #lnwq-box .lnwq-judge{font-weight:700;margin:0 0 6px}
  #lnwq-box .lnwq-judge.ok{color:var(--ok)}
  #lnwq-box .lnwq-judge.bad{color:var(--bad)}
  #lnwq-box .lnwq-actions{display:flex;gap:10px;margin-top:10px}
  #lnwq-box .lnwq-btn{background:#0d6efd;color:#fff;border:none;border-radius:10px;padding:10px 16px;font-weight:700;cursor:pointer}
  #lnwq-box .lnwq-btn:disabled{background:var(--muted);cursor:not-allowed}
  #lnwq-box .lnwq-secondary{background:#6c757d}
  #lnwq-box .lnwq-success{background:#28a745}
  #lnwq-box .lnwq-progress{margin-top:10px;font-weight:600}
  #lnwq-box .lnwq-result{text-align:center}
  @media (max-width:480px){#lnwq-box .lnwq-body{padding:16px}}
</style>

<script>
(function(){
  const root = document.getElementById('lnwq-box');

  // ตั้งหัวเรื่อง (แก้ได้)
  const quizHeader = {
    title: "แบบทดลองสอบ: นักวิชาการพาณิชย์",
    subtitle: "กรมเจรจาการค้าระหว่างประเทศ"
  };
  root.querySelector('.lnwq-title').textContent = quizHeader.title;
  root.querySelector('.lnwq-subtitle').textContent = quizHeader.subtitle;

  // ===== ข้อมูลข้อสอบ (4 ช้อย ก ข ค ง) =====
  const quizData = [
    {
      q: "ข้อใดคือหลักการที่สำคัญที่สุดขององค์การการค้าโลก (WTO) ที่ส่งเสริมการแข่งขันอย่างเป็นธรรม?",
      a: [
        {t:"หลักการไม่เลือกปฏิบัติ (Non-Discrimination)", ok:true},
        {t:"หลักการค้าเสรี (Free Trade)", ok:false},
        {t:"หลักการโปร่งใส (Transparency)", ok:false},
        {t:"หลักการใช้มาตรการปกป้อง (Safeguard Measures)", ok:false}
      ],
      ex: "หลักการนี้รวม MFN และ National Treatment ทำให้การแข่งขันเท่าเทียม"
    },
    {
      q:"ความตกลงใดของ WTO ที่เกี่ยวข้องโดยตรงกับการคุ้มครองทรัพย์สินทางปัญญา?",
      a:[{t:"GATT",ok:false},{t:"GATS",ok:false},{t:"TRIPS",ok:true},{t:"TBT",ok:false}],
      ex:"TRIPS คือความตกลงด้านทรัพย์สินทางปัญญาที่เกี่ยวกับการค้า"
    },
    {
      q:"ข้อใดไม่ใช่เสาหลักของ AEC Blueprint?",
      a:[
        {t:"การเป็นตลาดและฐานการผลิตเดียว",ok:false},
        {t:"การสร้างขีดความสามารถการแข่งขัน",ok:false},
        {t:"การรวมตัวเข้ากับเศรษฐกิจโลก",ok:false},
        {t:"การจัดตั้งกองทุนการเงินอาเซียน",ok:true}
      ],
      ex:"AEC Blueprint 2025 มี 4 เสา ไม่รวมกองทุนการเงิน"
    }
  ];

  // ===== องค์ประกอบ =====
  const qText = root.querySelector('#lnwq-qtext');
  const form = root.querySelector('#lnwq-form');
  const explain = root.querySelector('#lnwq-explain');
  const explainText = root.querySelector('#lnwq-explain-text');
  const judge = root.querySelector('#lnwq-judge');
  const submitBtn = root.querySelector('#lnwq-submit');
  const nextBtn = root.querySelector('#lnwq-next');
  const progress = root.querySelector('#lnwq-progress');
  const resultPanel = root.querySelector('#lnwq-result');
  const panel = root.querySelector('#lnwq-panel');
  const scoreEl = root.querySelector('#lnwq-score');
  const restartBtn = root.querySelector('#lnwq-restart');

  const letters = ["ก","ข","ค","ง"];
  let idx = 0, score = 0, answered = false;

  function render(){
    answered = false;
    submitBtn.disabled = true;
    nextBtn.hidden = true;
    explain.hidden = true;
    form.innerHTML = "";

    const item = quizData[idx];
    qText.textContent = `ข้อ ${idx+1}. ${item.q}`;
    progress.textContent = `ข้อ ${idx+1} / ${quizData.length}`;

    item.a.slice(0,4).forEach((opt,i)=>{
      const id = `lnwq-opt-${idx}-${i}`;
      const wrap = document.createElement('label');
      wrap.className = 'lnwq-choice';
      wrap.setAttribute('for', id);

      const radio = document.createElement('input');
      radio.type = 'radio';
      radio.name = 'lnwq-choice';
      radio.id = id;
      radio.value = String(i);
      radio.addEventListener('change', ()=> { if(!answered) submitBtn.disabled = false; });

      const letter = document.createElement('span');
      letter.className = 'lnwq-letter';
      letter.textContent = letters[i] + ".";

      const text = document.createElement('div');
      text.textContent = " " + opt.t;

      wrap.appendChild(radio);
      wrap.appendChild(letter);
      wrap.appendChild(text);
      form.appendChild(wrap);
    });
  }

  function submitAnswer(e){
    e.preventDefault();
    if(answered) return;
    const sel = form.querySelector('input[name="lnwq-choice"]:checked');
    if(!sel) return;

    answered = true;
    submitBtn.disabled = true;

    // ตรวจคำตอบ
    const chosen = Number(sel.value);
    const item = quizData[idx];

    // ไฮไลต์ถูก/ผิดและล็อกตัวเลือก
    [...form.querySelectorAll('input[name="lnwq-choice"]')].forEach((r,i)=>{
      r.disabled = true;
      const label = r.closest('.lnwq-choice');
      if(item.a[i].ok) label.classList.add('correct');
      if(i===chosen && !item.a[i].ok) label.classList.add('wrong');
    });

    // สรุปผลข้อนี้ + เฉลย
    const correct = item.a[chosen].ok === true;
    if(correct){ score++; judge.textContent = "ถูกต้อง!"; judge.className = "lnwq-judge ok"; }
    else{ judge.textContent = "ตอบไม่ถูก"; judge.className = "lnwq-judge bad"; }

    explainText.textContent = item.ex || "";
    explain.hidden = false;

    // ปุ่มถัดไป
    nextBtn.textContent = (idx === quizData.length-1) ? "สรุปผล" : "ข้อถัดไป";
    nextBtn.hidden = false;
  }

  function goNext(){
    if(idx < quizData.length-1){
      idx++;
      render();
    }else{
      panel.hidden = true;
      resultPanel.hidden = false;
      scoreEl.textContent = `${score}/${quizData.length}`;
    }
  }

  function restart(){
    idx = 0; score = 0;
    resultPanel.hidden = true;
    panel.hidden = false;
    render();
  }

  form.addEventListener('submit', submitAnswer);
  submitBtn.addEventListener('click', submitAnswer);
  nextBtn.addEventListener('click', goNext);
  if(restartBtn) restartBtn.addEventListener('click', restart);

  // เริ่มทำงาน
  render();
})();
</script>

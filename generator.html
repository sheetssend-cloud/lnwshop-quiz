<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ตัวสร้างโค้ดกล่องทดลองสอบ | Open Sheets</title>
<style>
  body{font-family:"Sarabun",system-ui,Segoe UI,Roboto,"Noto Sans Thai",sans-serif;margin:0;background:#f6f7fb}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  h1{margin:8px 0 16px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .card{background:#fff;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,.06);padding:16px}
  label{font-weight:700;display:block;margin-bottom:6px}
  input,textarea{width:100%;box-sizing:border-box;border:1px solid #d6d9df;border-radius:8px;padding:10px;font-size:14px}
  textarea{min-height:240px;font-family:ui-monospace,Consolas,monospace}
  .btn{background:#0d6efd;color:#fff;border:none;border-radius:10px;padding:10px 16px;font-weight:700;cursor:pointer}
  .btn.success{background:#198754}.btn.gray{background:#6c757d}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .small{font-size:12px;color:#555}
  #out{min-height:520px}
  #msg{margin:8px 0 0;font-size:14px}
  #msg.ok{color:#198754} #msg.err{color:#dc3545}
</style>
</head>
<body>
<div class="wrap">
  <h1>ตัวสร้างโค้ดทดลองสอบ (10 ข้อ) — Open Sheets</h1>
  <div class="grid">
    <div class="card">
      <div class="row">
        <div style="flex:1">
          <label>หัวข้อใหญ่ (แสดงในกล่อง)</label>
          <input id="title" value="แบบทดลองสอบ: นักวิชาการพาณิชย์">
        </div>
        <div style="flex:1">
          <label>หน่วยงาน/คำอธิบายย่อย</label>
          <input id="subtitle" value="กรมเจรจาการค้าระหว่างประเทศ">
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <div style="flex:1">
          <label>โลโก้ร้าน (URL รูป .png/.jpg)</label>
          <input id="logo" placeholder="https://.../logo.png">
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <div style="flex:1">
          <label>LINE OA ID (เช่น @openshetts)</label>
          <input id="line" value="@openshetts">
        </div>
        <div style="flex:1">
          <label>ลิงก์หน้าร้าน/หน้าสินค้า</label>
          <input id="shop" value="https://www.yourshop.example">
        </div>
      </div>
      <div style="margin-top:14px">
        <label>วางแนวข้อสอบ (ฟอร์แมตง่าย)</label>
        <textarea id="src" placeholder="วาง 10 ข้อที่นี่ ถ้าเว้นว่างจะเติมตัวอย่างให้อัตโนมัติ"></textarea>
        <div class="small">ใช้ตัวอักษร ก/ข/ค/ง • ใส่ <b>ANS:</b> (คำตอบ) และ <b>EXP:</b> (คำอธิบาย) • รองรับ <code>Q1:</code> หรือ <code>ข้อ 1.</code></div>
        <div id="msg"></div>
      </div>
      <div style="margin-top:12px" class="row">
        <button class="btn" onclick="generate()">Generate โค้ด</button>
        <button class="btn success" onclick="downloadOut()">ดาวน์โหลดไฟล์ (quiz.html)</button>
        <button class="btn gray" onclick="previewOut()">แสดงตัวอย่าง</button>
      </div>
    </div>

    <div class="card">
      <label>ผลลัพธ์ (quiz.html)</label>
      <textarea id="out"></textarea>
      <div class="small" style="margin-top:6px">คัดลอกทั้งหมดไปวางเป็นไฟล์ <b>quiz.html</b> หรือใช้ปุ่มดาวน์โหลด — แล้วอัปขึ้น GitHub Pages/Netlify → ฝัง iFrame ใน LnwShop</div>
    </div>
  </div>
</div>

<script>
/* ====== quiz.html template (ฝังมาแล้ว) ====== */
const TEMPLATE = `<!doctype html>
<html lang="th"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>__TITLE__ | Open Sheets</title>
<style>
  html,body{margin:0;background:#f0f2f5;font-family:"Sarabun",system-ui,Segoe UI,Roboto,"Noto Sans Thai",sans-serif}
  #lnwq-box{--p:#005c97;--p2:#363795;--ok:#198754;--bad:#dc3545;--muted:#6c757d;--text:#333;color:var(--text);-webkit-user-select:none;user-select:none}
  #lnwq-box .lnwq-container{background:#fff;border-radius:14px;box-shadow:0 6px 24px rgba(0,0,0,.08);max-width:800px;margin:16px auto;overflow:hidden}
  #lnwq-box .lnwq-header{background:linear-gradient(135deg,var(--p),var(--p2));color:#fff;padding:18px 22px;text-align:center;position:relative}
  #lnwq-box .lnwq-title{margin:0;font-size:1.35rem}
  #lnwq-box .lnwq-subtitle{margin:.25rem 0 0;opacity:.95}
  #lnwq-box .lnwq-brand{margin:.35rem 0 0;opacity:.95;font-size:.95rem}
  #lnwq-box .lnwq-logo{position:absolute;left:14px;top:14px;height:42px;width:auto;border-radius:8px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.15);padding:4px;object-fit:contain}
  #lnwq-box .lnwq-body{padding:22px}
  #lnwq-box .lnwq-qtext{font-weight:700;line-height:1.6;font-size:1.05rem;margin:0 0 16px}
  #lnwq-box .lnwq-answers{display:grid;gap:10px}
  #lnwq-box .lnwq-answer{background:#f8f9fa;border:2px solid #ced4da;border-radius:10px;padding:12px 14px;text-align:left;cursor:pointer;transition:.18s}
  #lnwq-box .lnwq-answer:hover:not([disabled]){background:#eef2f6;border-color:#0d6efd}
  #lnwq-box .lnwq-answer.lnwq-correct{background:#d1e7dd;border-color:var(--ok);color:#0f5132;font-weight:700}
  #lnwq-box .lnwq-answer.lnwq-wrong{background:#f8d7da;border-color:var(--bad);color:#842029}
  #lnwq-box .lnwq-answer:disabled{opacity:.9;cursor:not-allowed}
  #lnwq-box .lnwq-explain{background:#f8f9fa;border-left:5px solid #6c757d;padding:12px 14px;margin-top:14px;font-size:.98rem}
  #lnwq-box .lnwq-nav{display:flex;justify-content:space-between;align-items:center;margin-top:18px;padding-top:14px;border-top:1px solid #eee}
  #lnwq-box .lnwq-progress{font-weight:600}
  #lnwq-box .lnwq-btn{background:#0d6efd;color:#fff;border:none;border-radius:10px;padding:10px 18px;font-weight:700;cursor:pointer;transition:.18s;display:inline-block;text-decoration:none}
  #lnwq-box .lnwq-btn:disabled{background:var(--muted);cursor:not-allowed}
  #lnwq-box .lnwq-success{background:#28a745}
  #lnwq-box .lnwq-result-title{font-size:1.6rem;margin:0 0 6px}
  #lnwq-box .lnwq-score{font-size:2.6rem;font-weight:800;color:#005c97;margin:6px 0 14px}
  #lnwq-box .lnwq-cta{margin:8px 0 16px;display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  #lnwq-box .lnwq-cta-text{margin:0 10px 0 0}
  #lnwq-box .lnwq-line{background:#06c755} #lnwq-box .lnwq-shop{background:#0d6efd}
  *{-webkit-touch-callout:none} img{-webkit-user-drag:none;user-drag:none}
</style>
<body oncontextmenu="return false" ondragstart="return false" onselectstart="return false">
<div id="lnwq-box" aria-live="polite">
  <div class="lnwq-container" role="region" aria-label="แบบทดลองสอบ">
    <div class="lnwq-header">
      <img class="lnwq-logo" id="lnwq-logo" alt="Logo" src="__LOGO__">
      <h2 class="lnwq-title">__TITLE__</h2>
      <p class="lnwq-subtitle">__SUBTITLE__</p>
      <p class="lnwq-brand">ร้านหนังสือ <b>Open Sheets</b> — จัดจำหน่ายหนังสือแนวข้อสอบ | LINE: <b>__LINEOA__</b></p>
    </div>
    <div class="lnwq-body">
      <div id="lnwq-question-area">
        <p id="lnwq-question-text" class="lnwq-qtext"></p>
        <div id="lnwq-answers" class="lnwq-answers" role="group" aria-label="ตัวเลือกคำตอบ"></div>
        <div id="lnwq-explain" class="lnwq-explain" hidden><strong>คำอธิบาย:</strong> <span id="lnwq-explain-text"></span></div>
        <div class="lnwq-nav"><span id="lnwq-progress" class="lnwq-progress"></span><button id="lnwq-next" class="lnwq-btn" disabled>ข้อต่อไป</button></div>
      </div>
      <div id="lnwq-results" hidden>
        <h3 class="lnwq-result-title">ผลการทดสอบ</h3>
        <p>คุณทำได้</p><div id="lnwq-score" class="lnwq-score"></div>
        <div class="lnwq-cta">
          <p class="lnwq-cta-text">สนใจสั่งซื้อไฟล์/เล่ม กดปุ่มด้านล่างได้เลย</p>
          <a id="lnwq-btn-line" class="lnwq-btn lnwq-line" target="_blank" rel="noopener">แชทกับแอดมิน (LINE)</a>
          <a id="lnwq-btn-shop" class="lnwq-btn lnwq-shop" target="_blank" rel="noopener">สั่งซื้อที่หน้าร้าน</a>
        </div>
        <button id="lnwq-restart" class="lnwq-btn lnwq-success">ทำแบบทดสอบใหม่</button>
      </div>
    </div>
  </div>
</div>
<script>
const LOGO_URL="__LOGO__", LINE_OA_ID="__LINEOA__", SHOP_URL="__SHOP__", _b64='__B64__';
(function(){
  const R=document.getElementById('lnwq-box'), A=R.querySelector('#lnwq-answers');
  const Q=R.querySelector('#lnwq-question-text'), P=R.querySelector('#lnwq-progress');
  const N=R.querySelector('#lnwq-next'), E=R.querySelector('#lnwq-explain'), ET=R.querySelector('#lnwq-explain-text');
  const QA=R.querySelector('#lnwq-question-area'), RS=R.querySelector('#lnwq-results'), S=R.querySelector('#lnwq-score');
  const L=R.querySelector('#lnwq-btn-line'), H=R.querySelector('#lnwq-btn-shop'), LOG=R.querySelector('#lnwq-logo');
  if(!LOGO_URL){LOG.style.display='none'} else {LOG.src=LOGO_URL}
  const msg='สวัสดี สนใจสั่งซื้อสินค้านี้ '+(document.referrer||location.href);
  L.href='https://line.me/R/oaMessage/'+encodeURIComponent(LINE_OA_ID)+'/?'+encodeURIComponent(msg);
  H.href=SHOP_URL;
  function d(b){try{return JSON.parse(atob(b.replace(/\s+/g,'')));}catch(e){return []}}
  const D=d(_b64); let i=0,score=0,lock=false;
  function ren(){ lock=false; N.disabled=true; E.hidden=true; A.innerHTML='';
    const it=D[i]; if(!it){QA.hidden=true; RS.hidden=false; S.textContent=score+'/0'; return}
    Q.textContent='ข้อ '+(i+1)+'. '+it.q; P.textContent='ข้อ '+(i+1)+' / '+D.length;
    it.a.forEach((o,k)=>{const b=document.createElement('button'); b.className='lnwq-answer'; b.textContent=('กขคง'[k]||'')+'. '+o.t; b.onclick=()=>sel(o.ok); A.appendChild(b)})}
  function sel(ok){ if(lock) return; lock=true; [...A.children].forEach((b,j)=>{b.disabled=true; b.classList.add(D[i].a[j].ok?'lnwq-correct':'lnwq-wrong')}); if(ok)score++; ET.textContent=D[i].ex||''; E.hidden=false; N.textContent=(i===D.length-1)?'ดูผลคะแนน':'ข้อต่อไป'; N.disabled=false}
  function next(){ if(i<D.length-1){i++; N.textContent='ข้อต่อไป'; ren()} else {QA.hidden=true; RS.hidden=false; S.textContent=score+' / '+D.length} }
  R.querySelector('#lnwq-restart').onclick=()=>{i=0;score=0;lock=false;QA.hidden=false;RS.hidden=true;N.textContent='ข้อต่อไป';ren()}
  N.onclick=next; ren()
})();
</script>
</body></html>`;

/* ====== ตัวอย่าง 10 ข้อ (เติมให้อัตโนมัติถ้ากล่องว่าง) ====== */
const SAMPLE = `Q1: ข้อใดคือหลักการสำคัญของ WTO ที่ส่งเสริมการแข่งขันเท่าเทียม?
ก) หลักการไม่เลือกปฏิบัติ (Non-Discrimination)
ข) หลักการค้าเสรี
ค) หลักการโปร่งใส
ง) มาตรการปกป้อง
ANS: ก
EXP: หลักการ MFN + National Treatment

Q2: ความตกลงใดเกี่ยวกับทรัพย์สินทางปัญญา?
ก) GATT
ข) GATS
ค) TRIPS
ง) TBT
ANS: ค
EXP: TRIPS

Q3: ข้อใดไม่ใช่เสาหลักของ AEC?
ก) ตลาดและฐานการผลิตเดียว
ข) เสริมขีดความสามารถการแข่งขัน
ค) รวมตัวเข้ากับเศรษฐกิจโลก
ง) จัดตั้งกองทุนการเงินอาเซียน
ANS: ง
EXP: AEC Blueprint 2025 ไม่มี “กองทุนการเงินอาเซียน”

Q4: กฎว่าด้วยแหล่งกำเนิดสินค้าใน FTA ใช้เพื่อ?
ก) กำหนดภาษีแน่นอนทุกชนิด
ข) ยืนยันสัญชาติสินค้าที่ได้สิทธิภาษี
ค) ควบคุมมาตรฐาน SPS
ง) จำกัดโควตานำเข้า
ANS: ข
EXP: ป้องกันการสวมสิทธิ ต้องพิสูจน์สัญชาติสินค้า

Q5: “Single Undertaking” หมายถึง?
ก) เลือกรับเฉพาะบางความตกลงได้
ข) ต้องรับทั้งชุดหรือปฏิเสธทั้งชุด
ค) เจรจาทีละหัวข้อจนจบ
ง) ประเทศกำลังพัฒนาได้ยกเว้นส่วนใหญ่
ANS: ข
EXP: Nothing is agreed until everything is agreed.

Q6: หน่วยงานไทยที่ไต่สวน AD คือ?
ก) กรมศุลกากร
ข) กรมเจรจาการค้าระหว่างประเทศ
ค) กรมการค้าต่างประเทศ
ง) สคกค.
ANS: ค
EXP: DFT ดูแล AD/CVD/Safeguards

Q7: ความต่างสำคัญ RCEP vs CPTPP?
ก) RCEP มาตรฐานแรงงานสูงกว่า
ข) RCEP ริเริ่มโดยจีน, CPTPP โดยสหรัฐ
ค) RCEP มีสมาชิก/ขนาดเศรษฐกิจรวมใหญ่กว่า
ง) CPTPP เน้นภาษีสินค้า RCEP เน้นบริการ
ANS: ค
EXP: RCEP 15 ประเทศ ใหญ่สุดเมื่อวัด GDP+ประชากร

Q8: BATNA คือ?
ก) ข้อเสนอที่อีกฝ่ายให้ดีที่สุด
ข) จุดยืนสุดท้าย
ค) ทางเลือกดีที่สุดเมื่อเจรจาล้มเหลว
ง) ข้อตกลงเบื้องต้นร่วมกัน
ANS: ค
EXP: BATNA ที่ดีเพิ่มอำนาจต่อรอง

Q9: EU CBAM ระยะแรกกระทบสินค้ากลุ่ม?
ก) เกษตรและอาหารแปรรูป
ข) เหล็ก เหล็กกล้า อะลูมิเนียม ปุ๋ย
ค) อิเล็กทรอนิกส์และยานยนต์
ง) สิ่งทอ
ANS: ข
EXP: กลุ่มเข้มคาร์บอนสูง

Q10: National Single Window ของไทยคือ?
ก) พอร์ทัล BOI ต่างชาติ
ข) จุดเดียวเชื่อมข้อมูลนำเข้า-ส่งออก/โลจิสติกส์
ค) คลังข้อมูลกฎหมายการค้าทั้งหมด
ง) แพลตฟอร์มเจรจาการค้า
ANS: ข
EXP: อำนวยความสะดวกการค้า ลดซ้ำซ้อนเอกสาร`;

/* ====== Parser + Generator (แสดง error ในหน้า) ====== */
function parseSource(txt){
  if(!txt.trim()){ txt = SAMPLE; document.getElementById('src').value = SAMPLE; }
  const lines = txt.replace(/\r/g,'').split('\n');
  const list = []; const letters = {'ก':0,'ข':1,'ค':2,'ง':3};
  let cur=null, opts=['','','',''], exp=[];
  function push(){
    if(!cur) return;
    if(opts.filter(Boolean).length!==4) throw new Error('แต่ละข้อ ต้องมีช้อยส์ครบ 4 ตัว (ก ข ค ง)');
    if(cur.ans==null) throw new Error('ระบุ ANS: (คำตอบ) ให้ครบทุกข้อ');
    cur.ex = exp.join(' ').trim();
    list.push({q:cur.q.trim(), a:opts.map((t,i)=>({t,ok:i===cur.ans})), ex:cur.ex});
    cur=null; opts=['','','','']; exp=[];
  }
  for(const raw of lines){
    const L = raw.trim(); if(!L) continue;
    const qm = L.match(/^(?:Q\s*\d*|ข้อ\s*\d+)[\.\:\-：]\s*(.+)$/i);
    if(qm){ push(); cur={q:qm[1],ans:null,ex:''}; continue; }
    const om = L.match(/^([กขคง])[)\.\:\-]\s*(.+)$/);
    if(om){ const idx=letters[om[1]]; opts[idx]=om[2]; continue; }
    const am = L.match(/^ANS[\:\-：]\s*([กขคง1234])$/i);
    if(am){ if(!cur) throw new Error('พบ ANS: ก่อน Q:'); const v=am[1]; cur.ans=/[1234]/.test(v)?(+v-1):letters[v]; continue; }
    const em = L.match(/^EXP[\:\-：]\s*(.*)$/i);
    if(em){ if(!cur) throw new Error('พบ EXP: ก่อน Q:'); exp.push(em[1]); continue; }
    if(cur && cur.ans!=null) exp.push(L);
  }
  push();
  if(list.length!==10) throw new Error(`ต้องมี 10 ข้อพอดี (ตอนนี้ได้ ${list.length})`);
  return list;
}
function b64(o){ return btoa(unescape(encodeURIComponent(JSON.stringify(o)))); }
function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function setMsg(text, ok=false){ const m=document.getElementById('msg'); m.className = ok?'ok':'err'; m.textContent=text; }

function generate(){
  try{
    const title = document.getElementById('title').value || 'แบบทดลองสอบ';
    const subtitle = document.getElementById('subtitle').value || '';
    const logo = document.getElementById('logo').value || '';
    const line = document.getElementById('line').value || '@openshetts';
    const shop = document.getElementById('shop').value || 'https://www.yourshop.example';
    const arr = parseSource(document.getElementById('src').value);
    const data64 = b64(arr);

    const html = TEMPLATE
      .replaceAll('__TITLE__', escapeHtml(title))
      .replaceAll('__SUBTITLE__', escapeHtml(subtitle))
      .replaceAll('__LOGO__', logo)
      .replaceAll('__LINEOA__', line)
      .replaceAll('__SHOP__', shop)
      .replace('__B64__', data64);

    document.getElementById('out').value = html;
    setMsg('สร้างโค้ดสำเร็จ ✓ สามารถกด “แสดงตัวอย่าง” หรือ “ดาวน์โหลดไฟล์” ได้เลย', true);
  }catch(e){
    setMsg('ผิดรูปแบบ: ' + e.message, false);
  }
}

function downloadOut(){
  const txt=document.getElementById('out').value.trim();
  if(!txt){ setMsg('ยังไม่มีผลลัพธ์ — กรุณากด Generate ก่อน', false); return; }
  const blob=new Blob([txt],{type:'text/html;charset=utf-8'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='quiz.html';
  document.body.appendChild(a); a.click(); a.remove();
}
function previewOut(){
  const txt=document.getElementById('out').value.trim();
  if(!txt){ setMsg('ยังไม่มีผลลัพธ์ — กรุณากด Generate ก่อน', false); return; }
  const blob=new Blob([txt],{type:'text/html;charset=utf-8'});
  const url=URL.createObjectURL(blob); window.open(url,'_blank');
}

/* เติมตัวอย่างให้อัตโนมัติถ้ากล่องว่าง */
document.getElementById('src').value = SAMPLE;
</script>
</body>
</html>
